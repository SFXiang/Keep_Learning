#Autoware——障碍物检测研究


   通过对论文《激光点云在无人驾驶路径检测中的应用》的研究，理解了避障功能的基本逻辑，首先是对点云数据的采集，接着对点云数据进行一系列的数据处理，最后识别出障碍物。
##点云数据采集 
点云数据由激光雷达集成采集，雷达固定在汽车顶部，毫米波雷达扫描车头前方的范围;用于检测障碍物。
##具体流程
```
 flow
st=>start: 开始
e=>end: 结束
op1=>operation: 点云数据
op2=>operation: 计算聚类框
io1=>inputoutput: 障碍物点云
op3=>operation: 分割障碍物
op4=>operation: 选择可通行的区域

st->op1->io1->op2->op3->op4->e
op4->e
```

##点云分割（方法与Autoware中基于PCL的欧式聚类有不同，可以参考学习）
 车前两侧的单线激光雷达依据扫描顺序对无人车前方环境实行等角度扫描来获得障碍物的点云数据，而扫描范围内障碍物的位置则由数据之间的关系所反映。点云数据经过预处理后，再通过最近邻聚类的原理进行聚类，将车体四周障碍物提取处理。最近邻聚类的原理是基于同一物体表面的连续性。在一帧数据中，同一物体表面反射的数据往往表现为连续的点集，这些数据点位置较为邻近，若相邻两点间的位置突变，往往表明该两点分别属于两个不同物体的表面。
 因此，通过相邻两点的位置关系来判断该两点是否属于同一簇，如果两者的位置接近，则属于同一物体的可能性大，反之则比较小。将障碍物点云数据分成不同的簇:如果连续两点距离小于某一0值，则认为是同一物体的点云，否则分属不同物体。如果相邻点的数量超过某一i值，则认为它们属于同一障碍物，将其看作同一点云数据簇;同时，舍弃剩余的、分散的点云数据。为每簇点云数据分配边界框并进行标记，框内的点云数据距离框边界越近越好。最后，对边界框的几何特征进行描述和记录如图所示。

```
flow
st=>start: 开始
e=>end: 结束
op1=>operation: 激光雷达一帧数据
op2=>operation: 设i=1,j=1为点云簇个数(j为点云簇个数)
op3=>operation: 比较邻近两点间的距离(d=d1-d2)
op4=>operation: 两点不属于同一簇(j=j+1)
op5=>operation: 领近两点属于同一簇
op6=>operation: 更新点i=i+1
op7=>operation: 若簇内扫描点数量（N<D2）则舍弃该簇

cond1=>condition: 若d<=D1
cond2=>condition: 若i>n

st->op1->op2->op3->cond1
cond1(yes)->op5
cond1(no)->op4
op4->op6
op5->op6->cond2
cond2(yes)->op7
cond2(no)->op3
op7->e
```
## 障碍物识别
  每簇点云数据所标记的边界框，行人或类似车辆障碍物都被一个矩形边界框标记。然而，行人障碍物的边界框和类似车辆障碍物的边界框有着不同的尺寸。因此，根据尺寸分成两类障碍物，不同尺寸代表不同物种。应用主成分分析计算边界框的长度、宽度、朝向和几何位置。将探测提取出的障碍物信息和Autoware其他节点融合起来确定最终行车通行轨迹。